version: '3'

networks:
  titanh_network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.10.0.0/16

services:

  # First substrate node
  # substrate-titanh-node-1:
  #   image: substrate-titanh-node
  #   container_name: substrate-titanh-node-1
  #   networks:
  #     titanh_network:
  #   volumes:
  #     - ./scripts/substrate-node:/home/titanh/scripts
  #     - ./config/chain-specs:/home/titanh/specs
  #   environment:
  #     - CHAIN_SPEC=/home/titanh/specs/titanhSpecRaw.json
  #     - NODE_NAME=substrate-titanh-node-1
  #     - SEED_PHRASE=${SEED_SUBSTRATE_NODE_1}
  #   tty: true
  #   ports:
  #     - "9944:9944"
  #   entrypoint: ["/home/titanh/scripts/validator-entrypoint.sh"]

  # Second substrate node
  # substrate-titanh-node-2:
  #   image: substrate-titanh-node
  #   container_name: substrate-titanh-node-2
  #   networks:
  #     - titanh_network
  #   volumes:
  #     - ./scripts/substrate-node:/home/titanh/scripts
  #     - ./config/chain-specs:/home/titanh/specs
  #   environment:
  #     - CHAIN_SPEC=/home/titanh/specs/titanhSpecRaw.json
  #     - NODE_NAME=substrate-titanh-node-2
  #     - SEED_PHRASE=${SEED_SUBSTRATE_NODE_2}
  #     - BOOTNODE_HOST=substrate-titanh-node-1
  #   depends_on:
  #     - substrate-titanh-node-1
  #   tty: true
  #   entrypoint: ["/home/titanh/scripts/validator-entrypoint.sh"]
    

  titanh-ipfs-1:
    image: titanh-ipfs
    container_name: titanh-ipfs-1
    networks:
      - titanh_network
    volumes:
    - ./scripts/ipfs:/home/titanh-ipfs/config
    environment:
      - IPFS_REPLICAS=2
    
      - NODE_1_PRIVKEY=${IPFS_1_NODE_1_PRIVKEY}
      - NODE_1_PEERID=${IPFS_1_NODE_1_PEERID}

      - NODE_2_PRIVKEY=${IPFS_1_NODE_2_PRIVKEY}
      - NODE_2_PEERID=${IPFS_1_NODE_2_PEERID}
    ports:
      - 5001:5001
      - 8080:8080
    entrypoint: ["/home/titanh-ipfs/config/run-nodes.sh"]
    

  titanh-ipfs-2:
    image: titanh-ipfs
    container_name: titanh-ipfs-2
    networks:
      - titanh_network
    volumes:
    - ./scripts/ipfs:/home/titanh-ipfs/config
    environment:
      - IPFS_REPLICAS=2

      - NODE_1_PRIVKEY=${IPFS_2_NODE_1_PRIVKEY}
      - NODE_1_PEERID=${IPFS_2_NODE_1_PEERID}

      - NODE_2_PRIVKEY=${IPFS_2_NODE_2_PRIVKEY}
      - NODE_2_PEERID=${IPFS_2_NODE_2_PEERID}
    entrypoint: ["/home/titanh-ipfs/config/run-nodes.sh"]



  # pinning-node:
  #   build:
  #     context: ../pinning-node
  #     dockerfile: ../docker/dockerfiles/pinning-node.Dockerfile
  #   container_name: pinning-node
  #   networks:
  #     - titanh_network
  #   volumes:
  #     - ./config/pinning-node-1.json:/home/pinning_node/config/pinning-config.json
  #   tty: true


  #   ports:
  #     - "9944:9944"
  #     - "9615:9615"
  #     - "30333:30333"